<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Finding Meteorites Through Time</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-svg-annotation@2"></script>
<style>
html,body{margin:0;padding:0;height:100%;overflow:hidden;
  background:radial-gradient(circle at center,#1b2735,#090a0f),
             url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='4' height='4'><circle cx='2' cy='2' r='1' fill='white'/></svg>");
  background-size:cover,4px 4px;
  font-family:Roboto,sans-serif;
  color:#fff;
}
#controls{position:absolute;top:20px;left:40px;right:40px;display:flex;justify-content:space-between;z-index:1}
button{background:linear-gradient(135deg,#434343,#000);border:2px solid #fff;color:#fff;padding:8px 16px;border-radius:30px;cursor:pointer}
button:hover{box-shadow:0 0 10px rgba(255,255,255,0.6)}
.intro{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);padding:12px 24px;border:2px solid rgba(255,255,255,0.6);border-radius:8px;font-family:'Georgia',serif;font-size:24px;color:#fff;animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{box-shadow:0 0 10px rgba(255,255,255,0.6);border-color:rgba(255,255,255,0.6);}50%{box-shadow:0 0 20px rgba(255,255,255,1);border-color:rgba(255,255,255,1);}}
#chart{position:absolute;top:80px;bottom:20px;left:40px;right:40px;}
.axis path,.axis line{stroke:#555}
.axis text{fill:#ccc;font-size:12px}
.bar{fill:#888;stroke:#fff;stroke-width:1}
.bar.highlight{fill:#01f;filter:url(#glow)}
.annotation g{font-size:12px}
</style>
</head>
<body>
  <div id="controls">
    <button onclick="location.href='index.html'">Prev</button>
    <button onclick="location.href='scene2.html'">Next</button>
  </div>
  <div class="intro">Meteorites were rare in recorded history until the modern era.</div>
  <div id="chart"></div>
  <script>
    const margin={top:100,right:40,bottom:60,left:60};
    function draw(){
      const chart=d3.select('#chart');chart.selectAll('*').remove();
      const w=chart.node().clientWidth-margin.left-margin.right;
      const h=chart.node().clientHeight-margin.top-margin.bottom;
      const svg=chart.append('svg').attr('width','100%').attr('height','100%').attr('viewBox',`0 0 ${w+margin.left+margin.right} ${h+margin.top+margin.bottom}`);
      const defs=svg.append('defs');
      const glow=defs.append('filter').attr('id','glow');
      glow.append('feGaussianBlur').attr('stdDeviation',5).attr('result','coloredBlur');
      const merge=glow.append('feMerge');
      merge.append('feMergeNode').attr('in','coloredBlur');
      merge.append('feMergeNode').attr('in','SourceGraphic');
      const g=svg.append('g').attr('transform',`translate(${margin.left},${margin.top})`);
      d3.csv('Meteorite_Landings.csv',d=>({year:+d.year})).then(raw=>{
        const data=raw.filter(d=>d.year>=1750&&d.year<=2013);
        const byDec=d3.rollup(data,v=>v.length,d=>Math.floor(d.year/10)*10);
        const decades=Array.from(byDec.keys()).sort((a,b)=>a-b);
        const counts=decades.map(d=>byDec.get(d));
        const maxCount=d3.max(counts);
        const diffs=counts.slice(1).map((c,i)=>c-counts[i]);
        const peakIdx=diffs.indexOf(d3.max(diffs))+1;
        const peakDec=decades[peakIdx];
        const x=d3.scaleBand().domain(decades).range([0,w]).padding(0.1);
        const y=d3.scaleLinear().domain([0,maxCount]).nice().range([h,0]);
        g.append('g').attr('class','axis').attr('transform',`translate(0,${h})`).call(d3.axisBottom(x).tickFormat(d3.format('d')));
        g.append('g').attr('class','axis').call(d3.axisLeft(y));
        g.selectAll('.bar').data(decades.map((d,i)=>({dec:d,count:counts[i]}))).enter().append('rect')
          .attr('class',d=>d.dec===peakDec?'bar highlight':'bar')
          .attr('x',d=>x(d.dec)).attr('y',d=>y(d.count)).attr('width',x.bandwidth()).attr('height',d=>h-y(d.count));
        const ann=[{note:{label:`Discovery surge in the ${peakDec}s`},x:x(peakDec)+x.bandwidth()/2,y:y(counts[peakIdx]),dx:0,dy:-30}];
        g.append('g').attr('class','annotation').call(d3.annotation().annotations(ann));
      });
    }
    window.addEventListener('load',draw);
  </script>
</body>
</html>
